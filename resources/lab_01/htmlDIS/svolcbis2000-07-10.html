<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML lang="en"><HEAD>
<META http-equiv="Generator" content="com.bluecraft.htmlize">
<TITLE>Source Code: svolcbis2000-07-10.c</TITLE>
<STYLE>
body {
    background: ivory;
    color: black;
}
DIV.description {
    color: maroon;
    margin-top: -0.4cm;
}
SPAN.linenumber {
    color: maroon;
}
SPAN.string {
    color: red;
}
SPAN.comment {
    color: green;
}
SPAN.keyword {
    color: blue;
}
SPAN.userkeyword {
    color: purple;
    font-weight: bold;
}
</STYLE>
</HEAD><BODY>
<H2>svolcbis2000-07-10.c</H2>
<DIV class="description">
Generated by <STRONG>com.bluecraft.htmlize</STRONG> HTML-ization Utility Classes.
</DIV>
<PRE>
#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;string.h&gt;

#define N 50

<SPAN class="comment">/* dichiarazioni dei tipi */</SPAN>

typedef struct  {
     <SPAN class="userkeyword">char</SPAN>  autore[16];
     <SPAN class="userkeyword">char</SPAN>  opera[11];
     <SPAN class="userkeyword">char</SPAN>  tipo_opera;
     double  prezzo;
}  singolaopera;

typedef  singolaopera  galleria[N];

typedef  struct  autore {
     <SPAN class="userkeyword">char</SPAN>  nome[16];
     double  prezzo;
}  tipoautore;

<SPAN class="comment">/*  prototipi  */</SPAN>

FILE  *ApriFile(<SPAN class="userkeyword">char</SPAN>  *nome, <SPAN class="userkeyword">char</SPAN>  *modo);
<SPAN class="userkeyword">void</SPAN>  CostruisciFile(FILE  *f);
<SPAN class="userkeyword">void</SPAN>  CaricaArray(singolaopera  s, galleria  X, <SPAN class="userkeyword">int</SPAN>  *q);
<SPAN class="userkeyword">void</SPAN>  CercaMassimi(galleria  X, <SPAN class="userkeyword">int</SPAN>  k, galleria  S, <SPAN class="userkeyword">int</SPAN>  *a);
<SPAN class="userkeyword">void</SPAN>  CostruisciArray(<SPAN class="userkeyword">char</SPAN>  *nomefile, galleria  a1, <SPAN class="userkeyword">int</SPAN>  *n1, galleria  a2, <SPAN class="userkeyword">int</SPAN>  *n2);
<SPAN class="userkeyword">void</SPAN>  CercaMassimo(<SPAN class="userkeyword">char</SPAN>  *nomefile, double  *max);
<SPAN class="userkeyword">void</SPAN>  StampaArray(galleria  Y, <SPAN class="userkeyword">int</SPAN>  n);
<SPAN class="userkeyword">int</SPAN>  <SPAN class="userkeyword">main</SPAN>(<SPAN class="userkeyword">void</SPAN>);



FILE  *ApriFile(<SPAN class="userkeyword">char</SPAN>  *nome, <SPAN class="userkeyword">char</SPAN>  *modo)
{
	 FILE  *f;

	 f=fopen(nome, modo);
	 if(f==NULL)   {
	    fprintf(f, <SPAN class="string">"Impossibile aprire \"%s\" in modalità \"%s\".\n"</SPAN>, nome, modo);
	    exit(1);
	 }
	 return f;
}


<SPAN class="userkeyword">void</SPAN>  CostruisciFile(FILE  *f)
{
	 galleria  A;
	 <SPAN class="userkeyword">int</SPAN>  i=0, q;

	 do   {
	 printf(<SPAN class="string">"Inserire il nome dell'autore dell'opera\n"</SPAN>
		<SPAN class="string">"(max 15 caratteri)(premi INVIO per terminare)    : "</SPAN>);
	 gets(A[i].autore);
	 if(A[i].autore[0]==0)
	    break;
	 printf(<SPAN class="string">"Inserire il nome dell'opera(max 10 caratteri)    : "</SPAN>);
	 gets(A[i].opera);
	 printf(<SPAN class="string">"Inserire il tipo dell'opera\n"</SPAN>
		<SPAN class="string">"(un carattere: 'Q' per quadro e 'S' per scultura): "</SPAN>);
	 scanf(<SPAN class="string">"%c"</SPAN>, &amp;A[i].tipo_opera);
	 getchar();
	 printf(<SPAN class="string">"Inserire il prezzo dell'opera (in euro)          : "</SPAN>);
	 scanf(<SPAN class="string">"%lf"</SPAN>, &amp;A[i].prezzo);
	 getchar();
	 printf(<SPAN class="string">"\n"</SPAN>);
	 i++;
	 }  while(1);

	 q=i;
	 for(i=0; i&lt;q; i++)
	    fprintf(f, <SPAN class="string">"%s %s %c %.1E\n"</SPAN>, A[i].autore, A[i].opera, A[i].tipo_opera, A[i].prezzo);

	 return;
}


<SPAN class="userkeyword">void</SPAN>  CaricaArray(singolaopera  s, galleria  X, <SPAN class="userkeyword">int</SPAN>  *q)
{

	 X[*q]=s;
	 (*q)++;

	 return;
}


<SPAN class="userkeyword">void</SPAN>  CercaMassimi(galleria  X, <SPAN class="userkeyword">int</SPAN>  k, galleria  S, <SPAN class="userkeyword">int</SPAN>  *a)
{

	 <SPAN class="userkeyword">int</SPAN>  i;
	 double  max=0;

	 for(i=0; i&lt;k; i++)
	    if(X[i].prezzo&gt;max)
	       max=X[i].prezzo;

	 for(i=0; i&lt;k; i++)
	    if(X[i].prezzo==max)
	       CaricaArray(X[i], S, a);

	 return;
}


<SPAN class="comment">/* FUNZIONE RICHIESTA AL PUNTO 1.2 */</SPAN>
<SPAN class="userkeyword">void</SPAN>  CostruisciArray(<SPAN class="userkeyword">char</SPAN>  *nomefile, galleria  a1, <SPAN class="userkeyword">int</SPAN>  *n1, galleria  a2, <SPAN class="userkeyword">int</SPAN>  *n2)
{                          <SPAN class="comment">/*  *n1  dimensioni array  a1
			       *n2  dimensioni array  a2
			       (parametri d'output della funzione)  */</SPAN>

	 FILE  *f;
	 galleria  Q, S;
	 singolaopera  b;
	 <SPAN class="userkeyword">int</SPAN>  h=0, k=0;
	 <SPAN class="userkeyword">char</SPAN>  q=<SPAN class="string">'Q'</SPAN>;
	 (*n1)=0;
	 (*n2)=0;

	 f=ApriFile(nomefile, <SPAN class="string">"r"</SPAN>);

	 while(fscanf(f, <SPAN class="string">"%s%s %c%lf"</SPAN>, b.autore, b.opera, &amp;b.tipo_opera, &amp;b.prezzo)==4)
	    if(b.tipo_opera==q)
	       CaricaArray(b, Q, &amp;h);
	    else
	       CaricaArray(b, S, &amp;k);

	 <SPAN class="comment">/*  cerco i pió costosi */</SPAN>

	 CercaMassimi(Q, h, a1, n1);
	 CercaMassimi(S, k, a2, n2);

	 fclose(f);
	 return;
}


<SPAN class="comment">/* FUNZIONE RICHIESTA AL PUNTO 1.3 */</SPAN>
<SPAN class="userkeyword">void</SPAN>  CercaMassimo(<SPAN class="userkeyword">char</SPAN>  *nomefile, double  *max)
{

	 FILE  *f;
	 tipoautore  A[N];
	 <SPAN class="userkeyword">int</SPAN>  k, q, i=0, conta=0;
	 <SPAN class="userkeyword">char</SPAN>  t, nomeopera[11];
	 (*max)=0;                    <SPAN class="comment">/*  inizializzazione della variabile
							   tipo puntatore  */</SPAN>
	 f=ApriFile(nomefile, <SPAN class="string">"r"</SPAN>);

	 while(fscanf(f, <SPAN class="string">"%s%s %c%lf"</SPAN>, A[i].nome, nomeopera, &amp;t, &amp;A[i].prezzo)==4)
	    i++;

	 q=i;

	 for(i=0; i&lt;q; i++)
	    if(A[i].nome[0]!=0)
	       for(k=i+1; k&lt;q; k++)
		 if(strcmp(A[i].nome, A[k].nome)==0)   {
		      A[i].prezzo+=A[k].prezzo;
		      A[k].nome[0]=0;
		      conta++;
		 }

	 <SPAN class="comment">/*  cerco il massimo  */</SPAN>

	 for(i=0; i&lt;(q-conta); i++)
	    if(A[i].prezzo&gt;(*max))
		(*max)=A[i].prezzo;

	 fclose(f);
	 return;
}


<SPAN class="userkeyword">void</SPAN>  StampaArray(galleria  Y, <SPAN class="userkeyword">int</SPAN>  n)
{

	 if(n&gt;0)   {
	     printf(<SPAN class="string">"%s %s %c %.1E\n"</SPAN>, Y[0].autore, Y[0].opera, Y[0].tipo_opera, Y[0].prezzo);
	     StampaArray(Y+1, n-1);
	 }
	 return;
}


<SPAN class="userkeyword">int</SPAN>  <SPAN class="userkeyword">main</SPAN>(<SPAN class="userkeyword">void</SPAN>)
{

	 FILE  *fin;
	 <SPAN class="userkeyword">char</SPAN>  nome[21];
	 galleria  A, B;
	 <SPAN class="userkeyword">int</SPAN>  a, b;
	 double  massimo;

	 printf(<SPAN class="string">"Inserisci il nome del file di testo\n"</SPAN>
		<SPAN class="string">"dove memorizare i dati di tutte le opere: "</SPAN>);
	 gets(nome);
	 printf(<SPAN class="string">"\n"</SPAN>);

	 fin=ApriFile(nome, <SPAN class="string">"w"</SPAN>);

	 CostruisciFile(fin);

	 rewind(fin);

	 CostruisciArray(nome, A, &amp;a, B, &amp;b);

	 printf(<SPAN class="string">"\n"</SPAN>);
	 printf(<SPAN class="string">"Dati relativi ai quadri più cari:\n"</SPAN>);
	 StampaArray(A, a);
	 printf(<SPAN class="string">"\n"</SPAN>);
	 printf(<SPAN class="string">"Dati relativi alle sculture più care:\n"</SPAN>);
	 StampaArray(B, b);
	 printf(<SPAN class="string">"\n"</SPAN>);

	 CercaMassimo(nome, &amp;massimo);

	 printf(<SPAN class="string">"Il valore massimo delle opere associato ad ogni autore è:\n"</SPAN>);
	 printf(<SPAN class="string">"%g\n"</SPAN>, massimo);

	 return 0;
}



</PRE>
</BODY></HTML>
